{"version":3,"file":"team.speed.chart.bundle.js","sources":["../src/team.speed.chart.js"],"sourcesContent":["import {ajax, Loc, Runtime, Tag} from 'main.core';\n\nimport * as amcharts from 'amcharts4';\nimport * as am4themes_animated from 'amcharts4_theme_animated';\n\nimport {Layout} from 'ui.sidepanel.layout';\n\nimport '../css/base.css';\n\ntype Params = {\n\tgroupId: number\n}\n\ntype ChartData = {\n\tsprintName: string,\n\tplan: number,\n\tdone: number\n}\n\ntype Response = {\n\tdata: Array<ChartData>\n}\n\nexport class TeamSpeedChart\n{\n\tconstructor(params: Params)\n\t{\n\t\tthis.groupId = parseInt(params.groupId, 10);\n\n\t\t/* eslint-disable */\n\t\tthis.sidePanelManager = BX.SidePanel.Instance;\n\t\t/* eslint-enable */\n\n\t\tthis.chart = null;\n\t\tthis.chartData = null;\n\t}\n\n\tshow()\n\t{\n\t\tthis.sidePanelManager.open(\n\t\t\t'tasks-scrum-sprint-team-speed-chart-side-panel',\n\t\t\t{\n\t\t\t\tcacheable: false,\n\t\t\t\tevents: {\n\t\t\t\t\tonLoad: this.onSidePanelLoad.bind(this),\n\t\t\t\t\tonCloseComplete: this.onSidePanelAfterClose.bind(this)\n\t\t\t\t},\n\t\t\t\tcontentCallback: () => {\n\t\t\t\t\treturn Layout.createContent({\n\t\t\t\t\t\textensions: ['tasks.scrum.team-speed-chart'],\n\t\t\t\t\t\ttitle: Loc.getMessage('TASKS_SCRUM_TEAM_SPEED_CHART_TITLE'),\n\t\t\t\t\t\tcontent: this.createContent.bind(this),\n\t\t\t\t\t\tdesign: {\n\t\t\t\t\t\t\tsection: false\n\t\t\t\t\t\t},\n\t\t\t\t\t\tbuttons: []\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tonSidePanelLoad(event)\n\t{\n\t\tconst sidePanel = event.getSlider();\n\n\t\tsetTimeout(() => {\n\t\t\tthis.createChart(\n\t\t\t\tsidePanel.getContainer().querySelector('.tasks-scrum-sprint-team-speed-chart'),\n\t\t\t\tthis.chartData\n\t\t\t);\n\t\t}, 300);\n\t}\n\n\tonSidePanelAfterClose()\n\t{\n\t\tthis.destroyChart();\n\t}\n\n\tcreateContent()\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tajax.runAction(\n\t\t\t\t'bitrix:tasks.scrum.sprint.getTeamSpeedChartData',\n\t\t\t\t{\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tgroupId: this.groupId\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t)\n\t\t\t\t.then((response: Response) => {\n\t\t\t\t\tthis.chartData = response.data;\n\t\t\t\t\tresolve(this.render());\n\t\t\t\t})\n\t\t\t;\n\t\t});\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\treturn Tag.render`<div class=\"tasks-scrum-sprint-team-speed-chart\"></div>`;\n\t}\n\n\tcreateChart(chartDiv: HTMLElement, data: ChartData)\n\t{\n\t\tam4core.useTheme(am4themes_animated);\n\n\t\tthis.chart = am4core.create(chartDiv, am4charts.XYChart);\n\t\tthis.chart.data = data;\n\t\tthis.chart.paddingRight = 40;\n\t\tthis.chart.responsive.enabled = true;\n\n\t\t// todo this code doesn't work if project is open in slider.\n\t\t// this.chart.scrollbarX = new am4core.Scrollbar();\n\t\t// this.chart.scrollbarX.parent = this.chart.bottomAxesContainer;\n\t\t// this.chart.scrollbarX.thumb.minWidth = 50;\n\n\t\tthis.createAxises();\n\n\t\tthis.createColumn('plan', Loc.getMessage('TASKS_SCRUM_TEAM_SPEED_CHART_PLAN_COLUMN'), '#2882b3');\n\t\tthis.createColumn('done', Loc.getMessage('TASKS_SCRUM_TEAM_SPEED_CHART_DONE_COLUMN'), '#9c1f1f');\n\n\t\tthis.createLegend();\n\t}\n\n\tcreateAxises()\n\t{\n\t\tconst xAxis = this.chart.xAxes.push(new am4charts.CategoryAxis());\n\t\txAxis.dataFields.category = 'sprintName';\n\t\txAxis.renderer.grid.template.location = 0;\n\n\t\tconst label = xAxis.renderer.labels.template;\n\t\tlabel.wrap = true;\n\t\tlabel.maxWidth = 120;\n\n\t\tconst yAxis = this.chart.yAxes.push(new am4charts.ValueAxis());\n\t\tyAxis.min = 0;\n\t}\n\n\tcreateColumn(valueY: string, name: string, color: string)\n\t{\n\t\tconst series = this.chart.series.push(new am4charts.ColumnSeries());\n\t\tseries.dataFields.valueY = valueY;\n\t\tseries.dataFields.categoryX = 'sprintName';\n\t\tseries.name = name;\n\t\tseries.stroke = am4core.color(color);\n\t\tseries.fill = am4core.color(color);\n\n\t\t// const bullet = series.bullets.push(new am4charts.LabelBullet())\n\t\t// bullet.dy = 10;\n\t\t// bullet.label.text = '{valueY}';\n\t\t// bullet.label.fill = am4core.color('#ffffff');\n\n\t\treturn series;\n\t}\n\n\tcreateLegend()\n\t{\n\t\tthis.chart.legend = new am4charts.Legend();\n\t\tthis.chart.legend.position = 'bottom';\n\t\tthis.chart.legend.paddingBottom = 20;\n\t\tthis.chart.legend.itemContainers.template.clickable = false;\n\t}\n\n\tdestroyChart()\n\t{\n\t\tif (this.chart)\n\t\t{\n\t\t\tthis.chart.dispose();\n\t\t}\n\t}\n}"],"names":["TeamSpeedChart","params","groupId","parseInt","sidePanelManager","BX","SidePanel","Instance","chart","chartData","open","cacheable","events","onLoad","onSidePanelLoad","bind","onCloseComplete","onSidePanelAfterClose","contentCallback","Layout","createContent","extensions","title","Loc","getMessage","content","design","section","buttons","event","sidePanel","getSlider","setTimeout","createChart","getContainer","querySelector","destroyChart","Promise","resolve","reject","ajax","runAction","data","then","response","render","Tag","chartDiv","am4core","useTheme","am4themes_animated","create","am4charts","XYChart","paddingRight","responsive","enabled","createAxises","createColumn","createLegend","xAxis","xAxes","push","CategoryAxis","dataFields","category","renderer","grid","template","location","label","labels","wrap","maxWidth","yAxis","yAxes","ValueAxis","min","valueY","name","color","series","ColumnSeries","categoryX","stroke","fill","legend","Legend","position","paddingBottom","itemContainers","clickable","dispose"],"mappings":"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"}