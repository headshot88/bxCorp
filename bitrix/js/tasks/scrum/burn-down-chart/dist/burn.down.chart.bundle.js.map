{"version":3,"file":"burn.down.chart.bundle.js","sources":["../src/burn.down.chart.js"],"sourcesContent":["import {ajax, Loc, Text, Tag, Dom} from 'main.core';\n\nimport * as am4core from 'amcharts4';\nimport * as am4themes_animated from 'amcharts4_theme_animated';\n\nimport {Layout} from 'ui.sidepanel.layout';\n\nimport '../css/base.css';\n\ntype Params = {\n\tgroupId: number,\n\tsprintId: number\n}\n\ntype ChartData = {\n\tday: number,\n\tidealValue: number,\n\tremainValue: number\n}\n\ntype SprintData = {\n\tname: string\n}\n\ntype Response = {\n\tdata: {\n\t\tsprint: SprintData,\n\t\tchart: Array<ChartData>\n\t}\n}\n\nexport class BurnDownChart\n{\n\tconstructor(params: Params)\n\t{\n\t\tthis.groupId = parseInt(params.groupId, 10);\n\t\tthis.sprintId = parseInt(params.sprintId, 10);\n\n\t\t/* eslint-disable */\n\t\tthis.sidePanelManager = BX.SidePanel.Instance;\n\t\t/* eslint-enable */\n\n\t\tthis.chart = null;\n\t\tthis.sprintData = null;\n\t\tthis.chartData = null;\n\t}\n\n\tshow()\n\t{\n\t\tthis.sidePanelManager.open(\n\t\t\t'tasks-scrum-sprint-burn-down-chart-side-panel',\n\t\t\t{\n\t\t\t\tcacheable: false,\n\t\t\t\tevents: {\n\t\t\t\t\tonLoad: this.onSidePanelLoad.bind(this),\n\t\t\t\t\tonCloseComplete: this.onSidePanelAfterClose.bind(this)\n\t\t\t\t},\n\t\t\t\tcontentCallback: () => {\n\t\t\t\t\treturn Layout.createContent({\n\t\t\t\t\t\textensions: ['tasks.scrum.burn-down-chart'],\n\t\t\t\t\t\ttitle: Loc.getMessage('TASKS_SCRUM_SPRINT_BURN_DOWN_CHART_TITLE'),\n\t\t\t\t\t\tcontent: this.createContent.bind(this),\n\t\t\t\t\t\tdesign: {\n\t\t\t\t\t\t\tsection: false\n\t\t\t\t\t\t},\n\t\t\t\t\t\tbuttons: []\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tonSidePanelLoad()\n\t{\n\t\tsetTimeout(() => {\n\t\t\tthis.createChart(this.node, this.chartData);\n\t\t\tDom.insertBefore(this.renderInfo(this.sprintData), this.node);\n\t\t}, 300);\n\t}\n\n\tonSidePanelAfterClose()\n\t{\n\t\tthis.destroyChart();\n\t}\n\n\tcreateContent()\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tajax.runAction(\n\t\t\t\t'bitrix:tasks.scrum.sprint.getBurnDownChartData',\n\t\t\t\t{\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tgroupId: this.groupId,\n\t\t\t\t\t\tsprintId: this.sprintId\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t)\n\t\t\t\t.then((response: Response) => {\n\t\t\t\t\tthis.sprintData = response.data.sprint;\n\t\t\t\t\tthis.chartData = response.data.chart;\n\t\t\t\t\tresolve(this.renderChart());\n\t\t\t\t})\n\t\t\t;\n\t\t});\n\t}\n\n\trenderChart(): HTMLElement\n\t{\n\t\tthis.node = Tag.render`<div class=\"tasks-scrum-sprint-burn-down-chart\"></div>`;\n\n\t\treturn this.node;\n\t}\n\n\trenderInfo(sprint: SprintData)\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"tasks-scrum-sprint-burn-down-info\">\n\t\t\t\t<div class=\"tasks-scrum-sprint-burn-down-info-name\">\n\t\t\t\t\t${Text.encode(sprint.name)}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tcreateChart(chartDiv: HTMLElement, data: ChartData)\n\t{\n\t\twindow.am4core.useTheme(am4themes_animated);\n\n\t\tthis.chart = window.am4core.create(chartDiv, am4charts.XYChart);\n\t\tthis.chart.data = data;\n\t\tthis.chart.paddingRight = 40;\n\n\t\tthis.createAxises();\n\n\t\tthis.createIdealLine();\n\t\tthis.createRemainLine();\n\n\t\tthis.createLegend();\n\t}\n\n\tcreateAxises()\n\t{\n\t\tconst categoryAxis = this.chart.xAxes.push(new am4charts.CategoryAxis());\n\t\tcategoryAxis.renderer.grid.template.location = 0;\n\t\tcategoryAxis.dataFields.category = 'day';\n\t\tcategoryAxis.renderer.minGridDistance = 60;\n\n\t\tconst valueAxis = this.chart.yAxes.push(new am4charts.ValueAxis());\n\t\tvalueAxis.min = -0.1;\n\t}\n\n\tcreateIdealLine()\n\t{\n\t\tconst lineSeries = this.chart.series.push(new am4charts.LineSeries());\n\t\tlineSeries.name = Loc.getMessage('TASKS_SCRUM_SPRINT_IDEAL_BURN_DOWN_CHART_LINE_LABEL');\n\t\tlineSeries.stroke = window.am4core.color('#2882b3');\n\t\tlineSeries.strokeWidth = 2;\n\n\t\tlineSeries.dataFields.categoryX = 'day';\n\t\tlineSeries.dataFields.valueY = 'idealValue';\n\n\t\tconst circleColor = '#2882b3';\n\t\tconst circleBullet = new am4charts.CircleBullet();\n\t\tcircleBullet.circle.radius = 4;\n\t\tcircleBullet.circle.fill = window.am4core.color(circleColor);\n\t\tcircleBullet.circle.stroke = window.am4core.color(circleColor);\n\n\t\tlineSeries.bullets.push(circleBullet);\n\n\t\tconst segment = lineSeries.segments.template;\n\t\tconst hoverState = segment.states.create('hover');\n\t\thoverState.properties.strokeWidth = 4;\n\t}\n\n\tcreateRemainLine()\n\t{\n\t\tconst lineSeries = this.chart.series.push(new am4charts.LineSeries());\n\t\tlineSeries.name = Loc.getMessage('TASKS_SCRUM_SPRINT_REMAIN_BURN_DOWN_CHART_LINE_LABEL');\n\t\tlineSeries.stroke = window.am4core.color('#9c1f1f');\n\t\tlineSeries.strokeWidth = 2;\n\n\t\tlineSeries.dataFields.categoryX = 'day';\n\t\tlineSeries.dataFields.valueY = 'remainValue';\n\n\t\tconst circleColor = '#9c1f1f';\n\t\tconst circleBullet = new am4charts.CircleBullet();\n\t\tcircleBullet.circle.radius = 4;\n\t\tcircleBullet.circle.fill = window.am4core.color(circleColor);\n\t\tcircleBullet.circle.stroke = window.am4core.color(circleColor);\n\n\t\tlineSeries.bullets.push(circleBullet);\n\n\t\tconst segment = lineSeries.segments.template;\n\t\tconst hoverState = segment.states.create('hover');\n\t\thoverState.properties.strokeWidth = 4;\n\t}\n\n\tcreateLegend()\n\t{\n\t\tthis.chart.legend = new am4charts.Legend();\n\t\tthis.chart.legend.itemContainers.template.clickable = false;\n\t\tthis.chart.legend.position = 'bottom';\n\t\tthis.chart.legend.itemContainers.template.events.on('over', (event) => {\n\t\t\tthis.processOver(event.target.dataItem.dataContext);\n\t\t});\n\t\tthis.chart.legend.itemContainers.template.events.on('out', () => this.processOut());\n\t}\n\n\tprocessOver(hoveredLine)\n\t{\n\t\thoveredLine.toFront();\n\t\thoveredLine.segments.each((segment) => segment.setState('hover'));\n\t};\n\n\tprocessOut()\n\t{\n\t\tthis.chart.series.each((series) => {\n\t\t\tseries.segments.each((segment) => segment.setState('default'));\n\t\t\tseries.bulletsContainer.setState('default');\n\t\t});\n\t};\n\n\tdestroyChart()\n\t{\n\t\tif (this.chart)\n\t\t{\n\t\t\tthis.chart.dispose();\n\t\t}\n\t}\n}"],"names":["BurnDownChart","params","groupId","parseInt","sprintId","sidePanelManager","BX","SidePanel","Instance","chart","sprintData","chartData","open","cacheable","events","onLoad","onSidePanelLoad","bind","onCloseComplete","onSidePanelAfterClose","contentCallback","Layout","createContent","extensions","title","Loc","getMessage","content","design","section","buttons","setTimeout","createChart","node","Dom","insertBefore","renderInfo","destroyChart","Promise","resolve","reject","ajax","runAction","data","then","response","sprint","renderChart","Tag","render","Text","encode","name","chartDiv","window","am4core","useTheme","am4themes_animated","create","am4charts","XYChart","paddingRight","createAxises","createIdealLine","createRemainLine","createLegend","categoryAxis","xAxes","push","CategoryAxis","renderer","grid","template","location","dataFields","category","minGridDistance","valueAxis","yAxes","ValueAxis","min","lineSeries","series","LineSeries","stroke","color","strokeWidth","categoryX","valueY","circleColor","circleBullet","CircleBullet","circle","radius","fill","bullets","segment","segments","hoverState","states","properties","legend","Legend","itemContainers","clickable","position","on","event","processOver","target","dataItem","dataContext","processOut","hoveredLine","toFront","each","setState","bulletsContainer","dispose"],"mappings":"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"}